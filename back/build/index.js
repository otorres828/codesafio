(()=>{var e={251:(e,r,s)=>{const o=new(s(661).Database)("./src/config/database.sqlite",(e=>{e?console.error("Error al conectar a la base de datos:",e.message):console.log("Conexión exitosa a la base de datos SQLite")}));process.on("SIGINT",(()=>{o.close((e=>{e?console.error("Error al cerrar la conexión de la base de datos:",e.message):console.log("Conexión de la base de datos cerrada"),process.exit(0)}))})),e.exports=o},93:(e,r,s)=>{const o=s(96),t=s(344),a=s(251);e.exports={login:async(e,r)=>{const{nick:s,clave:n}=e.body;try{a.get("SELECT * FROM usuarios WHERE nick = ? LIMIT 1",[s],(async(e,s)=>{if(e)return r.sendStatus(200);if(!s)return r.status(200).json({error:"Usuario no encontrado"});const a=s.clave;if(await o.compare(n,a)){const e={id:s.id,nick:s.nick},o=(i=e,t.sign(i,"KGGK>HKHVHJVKBKJKJBKBKHKBMKHB",{expiresIn:"30d"}));r.status(200).json({token_codesafio:o})}else r.status(401).json({error:"Credenciales inválidas"});var i}))}catch(e){console.error("Error al autenticar usuario:",e),r.status(500).json({error:"Error interno del servidor"})}},register:async(e,r)=>{const{nick:s,clave:t}=e.body;try{a.get("SELECT * FROM usuarios WHERE nick = ?",[s],(async(e,s)=>e?r.status(400).json({error:"El usuario ya existe"}):s?r.status(200).json({error:"El nick ya está registrado"}):void 0));const e=await o.hash(t,10),n="INSERT INTO usuarios (nick, clave) VALUES (?, ?)";a.run(n,[s,e],(async function(e){if(e)return r.sendStatus(500);r.json({message:"Registro exitoso"})}))}catch(e){console.error("Error al registrar usuario"),r.status(500).json({error:"Error interno del servidor"})}}}},509:(e,r,s)=>{const o=s(364),t=s(251);e.exports={crear_lapsos:(e,r)=>{const{nombre_lapso:s}=e.body;if(console.log(o(e)),!s)return r.status(400).json({error:'El campo "nombre_lapso" es requerido'});t.run("INSERT INTO lapsos (nombre_lapso) VALUES (?)",[s],(function(e){if(e)return console.error("Error al insertar el lapso:",e.message),r.status(200).json({error:"Error interno del servidor"});r.status(201).json({id:this.lastID,mensaje:"Lapso creado con éxito"})}))}}},138:(e,r,s)=>{const o=s(860),t=s(582),a=s(685),n=s(77),i=s(251);let c=o(),E=a.createServer(c);const u=s(866),l=s(454);c.use(t()),c.use(o.urlencoded({extended:!1})),c.use(o.json()),c.use(u),c.use(l),i.serialize((()=>{i.run("CREATE TABLE IF NOT EXISTS usuarios (id INTEGER PRIMARY KEY AUTOINCREMENT, nick VARCHAR(255), clave VARCHAR(255))"),i.run("CREATE TABLE IF NOT EXISTS lapsos (lapso_id INTEGER PRIMARY KEY AUTOINCREMENT, nombre_lapso VARCHAR(255))"),i.run("CREATE TABLE IF NOT EXISTS materias (materia_id INTEGER PRIMARY KEY AUTOINCREMENT, titulo VARCHAR(255), subtitulo VARCHAR(255), icono TEXT, fecha_hora DATETIME, lapso_id INTEGER, FOREIGN KEY (lapso_id) REFERENCES lapsos(lapso_id))"),i.run("CREATE TABLE IF NOT EXISTS recordatorios (record_id INTEGER PRIMARY KEY AUTOINCREMENT, materia_id INTEGER, fecha_hora DATETIME, FOREIGN KEY (materia_id) REFERENCES materias(materia_id))"),i.run("CREATE TABLE IF NOT EXISTS notas (notas_id INTEGER PRIMARY KEY AUTOINCREMENT, nombre_examen VARCHAR(255), nota_obtenida REAL, porcentaje_evaluacion REAL, materia_id INTEGER, FOREIGN KEY (materia_id) REFERENCES materias(materia_id))")}));const d=process.env.PORT||4e3;E.listen(d,"0.0.0.0",(()=>{console.log(`Servidor corriendo en el puerto ${d}`)})),c.get("/",((e,r)=>{const s=n.address();r.send(s)})),e.exports=c},364:(e,r,s)=>{const o=s(344);e.exports=e=>{const r=e.headers.authorization.split(" ")[1];return o.verify(r,"KGGK>HKHVHJVKBKJKJBKBKHKBMKHB").id}},672:(e,r,s)=>{const o=s(860),t=s(344),a=o.Router();a.use(((e,r,s)=>{let o=e.headers["x-access-token"]||e.headers.authorization;if(!o||null==o)return r.status(401).json({error:"Es necesario el token para acceder a la aplicación"});o.startsWith("Bearer ")&&(o=o.slice(7,o.length)),o&&t.verify(o,"KGGK>HKHVHJVKBKJKJBKBKHKBMKHB",((o,t)=>{if(o)return r.json({message:"Token no válido"});e.decoded=t,s()}))})),e.exports=a},866:(e,r,s)=>{const o=s(860),{login:t,register:a}=s(93),n=o.Router();n.post("/login",t),n.post("/registrarse",a),e.exports=n},454:(e,r,s)=>{const o=s(860),{crear_lapsos:t}=s(509),a=s(672),n=o.Router();n.post("/crear_lapsos",a,t),e.exports=n},96:e=>{"use strict";e.exports=require("bcrypt")},582:e=>{"use strict";e.exports=require("cors")},860:e=>{"use strict";e.exports=require("express")},77:e=>{"use strict";e.exports=require("ip")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},661:e=>{"use strict";e.exports=require("sqlite3")},685:e=>{"use strict";e.exports=require("http")}},r={};!function s(o){var t=r[o];if(void 0!==t)return t.exports;var a=r[o]={exports:{}};return e[o](a,a.exports,s),a.exports}(138)})();